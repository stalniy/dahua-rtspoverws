<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Dahua - RTSP over Websocket</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>

  <body>
    <canvas id="canvas" width="500" style="width: 500px !important"></canvas>

    <video id="videoplayer"></video>

    <script type="module">
      import { PlayerControl } from "./PlayerControl.js";

      const cameraIp = process.env.CAMERA_IP;
      let player = new PlayerControl({
        wsURL: `ws://${cameraIp}/rtspoverwebsocket`,
        rtspURL: `rtsp://${cameraIp}/cam/realmonitor?channel=1&subtype=0`,
        authenticationUrl: `http://localhost:12345`,
      });
      player.on("Error", (j) => {
        if (j) console.log(j.errorCode);
      });
      player.init(
        document.querySelector("#canvas"),
        document.querySelector("#videoplayer")
      );

      let isAudioEnabled = false;
      let isConnected = false;
      window.$player = player;
      window.togglePlay = function toggleAudio() {
        isAudioEnabled = !isAudioEnabled;

        // player.setAudioVolume(isAudioEnabled ? 1 : 0);
        console.log('audio enabled', isAudioEnabled)
        if (isAudioEnabled) {
          if (!isConnected) {
            isConnected = true;
            player.connect();
          } else {
            player.play();
          }
          player.setAudioVolume(1)
          // player.audioPlay();
        } else {
          player.pause();
          player.setAudioVolume(0)
          // player.audioStop();
        }
      }
    </script>

    <button onclick="togglePlay()">toggle play</button>
    <button onclick="$player.capture('test')">take screenshot</button>
  </body>
</html>
